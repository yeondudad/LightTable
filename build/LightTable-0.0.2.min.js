function LightTable(a){var b=document.querySelector("#light-table"),c=b.querySelector(".lt-navigation"),d=b.querySelector(".lt-opacity"),e=b.querySelector(".lt-mover"),f=b.querySelector(".lt-images"),g=b.querySelector(".lt-guide"),h=b.querySelector(".lt-search button"),i=c.querySelector(".lt-dragger button"),j=e.querySelector(".lt-dragger button"),k=new lt.model.Images("LightTableImages",a),l=new lt.model.Position("LightTableNavigation"),m=new lt.model.Position("LightTableMover"),n=new lt.controller.Opaciter(d,k),o=new lt.controller.Mover(e,k),p=new lt.controller.Images(h,f,k),q=new lt.controller.Guide(g,k),r=new lt.controller.Dragger(c,i,l),s=new lt.controller.Dragger(e,j,m);return{models:{images:k,navigationPosition:l,moverPosition:m},controllers:{opaciter:n,mover:o,images:p,guide:q,opaciterDragger:r,moverDragger:s}}}window.lt||(window.lt={}),lt.model=lt.model||{},lt.controller=lt.controller||{},lt.helper=lt.helper||{},lt.controller.Dragger=function(a,b,c){this.dragTarget=a,this.dragButton=b,this._touchPosition={},this._elementPosition={},this._model=c,this._bindEvents(),this._dragging(this._model.value())},lt.controller.Dragger.prototype={_bindEvents:function(){this.dragButton.addEventListener("touchstart",this._onTouchstartDragButton.bind(this)),this.dragButton.addEventListener("touchmove",this._onTouchmoveDragButton.bind(this)),this.dragButton.addEventListener("touchend",this._onTouchendDragButton.bind(this))},_onTouchstartDragButton:function(a){a.preventDefault(),a.stopPropagation(),this._touchPosition.x=a.touches[0].clientX,this._touchPosition.y=a.touches[0].clientY,this._elementPosition.x=parseInt(this.dragTarget.style.left,10),this._elementPosition.y=parseInt(this.dragTarget.style.top,10)},_onTouchmoveDragButton:function(a){a.preventDefault(),a.stopPropagation();var b=a.touches[0].clientX-this._touchPosition.x,c=a.touches[0].clientY-this._touchPosition.y,d={};d.x=b+this._elementPosition.x,d.y=c+this._elementPosition.y,this._dragging(d)},_onTouchendDragButton:function(a){a.preventDefault(),a.stopPropagation();var b=a.changedTouches[0].clientX-this._touchPosition.x,c=a.changedTouches[0].clientY-this._touchPosition.y,d={};d.x=b+this._elementPosition.x,d.y=c+this._elementPosition.y,this._model.value(d)},_dragging:function(a){this.dragTarget.style.top=a.y+"px",this.dragTarget.style.left=a.x+"px"}},lt.controller.Guide=function(a,b){this.guideWrapper=a,this._model=b,this._render(),this._bindEvents()},lt.controller.Guide.prototype={_render:function(){null!==this._model.path()&&(this.guideWrapper.innerHTML='<img src="'+this._model.path()+'">'),this.guideWrapper.style.top=this._model.position().y+"px",this.guideWrapper.style.left=this._model.position().x+"px",this.guideWrapper.style.opacity=this._model.opacity()},_bindEvents:function(){this._model.addOpacityListener(this._onOpacityUpdate.bind(this)),this._model.addPositionListener(this._onPositionUpdate.bind(this)),this._model.addPathListener(this._onPathUpdate.bind(this))},_onOpacityUpdate:function(a){this.guideWrapper.style.opacity=a},_onPositionUpdate:function(a){this.guideWrapper.style.top=a.y+"px",this.guideWrapper.style.left=a.x+"px"},_onPathUpdate:function(a){this.guideWrapper.innerHTML='<img src="'+a+'">'}},lt.controller.Images=function(a,b,c){this.selectButton=a,this.imagesWrapper=b,this.imagesList=null,this._screenWidth=0,this._imageWidth=0,this._current=0,this._count=c.count()-1,this._deltaX=0,this._startX=0,this._startTime=0,this._model=c,this._initWidthValues(),this._assignElements(),this._bindEvents(),this._render()},lt.controller.Images.prototype={_render:function(){var a=this,b="";this._model.each(function(c){b=b+'<li class="lst-img" style="width:'+a._imageWidth+'px"><button>선택</button><img src="'+c+'"/></li>'}),this.imagesList.innerHTML=b,this._translate(this._current)},_initWidthValues:function(){this._screenWidth=screen.width,this._imageWidth=this._screenWidth-40},_assignElements:function(){this.imagesList=this.imagesWrapper.querySelector("ul")},_bindEvents:function(){this.selectButton.addEventListener("click",this._onClickSelectButton.bind(this)),this.imagesList.addEventListener("touchstart",this._onTouchstartImagesList.bind(this)),this.imagesList.addEventListener("touchmove",this._onTouchmoveImagesList.bind(this)),this.imagesList.addEventListener("touchend",this._onTouchendImagesList.bind(this)),this.imagesList.addEventListener("touchend",this._onTouchendImagesButton.bind(this))},_onClickSelectButton:function(a){a.preventDefault(),a.stopPropagation(),this.imagesWrapper.style.display="block"},_onTouchstartImagesList:function(a){a.preventDefault(),a.stopPropagation();var b=null;("LI"===a.target.tagName||"LI"===a.target.parentNode.tagName)&&(b=parseInt(this.imagesList.style.margin.match(/-?\w+px$/g)[0],10)),this._panelX=parseInt(b,10),this._startX=a.touches[0].pageX,this._startTime=Date.now()},_onTouchmoveImagesList:function(a){a.preventDefault(),a.stopPropagation(),this._deltaX=a.touches[0].pageX-this._startX,(this._swipeToRightHead()||this._swipeToLeftTail())&&(this._deltaX=this._deltaX/2.5),this._translate(this._deltaX+this._panelX,0)},_onTouchendImagesList:function(a){a.preventDefault(),a.stopPropagation(),this._canSwipe()&&this._wasLeftSwipe()&&(this._current=this._current+1),this._canSwipe()&&this._wasRightSwipe()&&(this._current=this._current-1),this._translate(this._getSwipeDist(),this._getSwipeSpeed()),this._deltaX=0,this._startX=0},_onTouchendImagesButton:function(a){a.preventDefault(),a.stopPropagation(),"BUTTON"===a.target.tagName&&(this._model.path(this._model.images[this._current]),this.imagesWrapper.style.display="none")},_wasLeftSwipe:function(){return this._deltaX<0},_wasRightSwipe:function(){return this._deltaX>0},_swipeToLeftTail:function(){return this._current===this._count&&this._wasLeftSwipe()},_swipeToRightHead:function(){return 0===this._current&&this._wasRightSwipe()},_getSwipeSpeed:function(){var a=Date.now()-this._startTime;return a>500&&(a=500),a},_getSwipeDist:function(){return this._current*-this._screenWidth},_canSwipe:function(){return this._swipeToRightHead()===!1&&this._swipeToLeftTail()===!1&&Math.abs(this._deltaX)>this._screenWidth/2.5},_translate:function(a,b){var c="",d=this.imagesList.style;b=b||0,0!==b&&(c="all "+b+"ms"),["webkit","moz","ms","o"].forEach(function(a){d[a+"Transition"]=c}),d.margin="0 0 0 "+a+"px",d.transition=c}},lt.controller.Mover=function(a,b){this.moverWrapper=a,this.upButton=null,this.rightButton=null,this.downButton=null,this.leftButton=null,this._timeoutTimer=0,this._intervalTimer=0,this._model=b,this._assignElements(),this._bindEvents()},lt.controller.Mover.prototype={_assignElements:function(){this.upButton=this.moverWrapper.querySelector("[data-role=image-pos-up]"),this.rightButton=this.moverWrapper.querySelector("[data-role=image-pos-right]"),this.downButton=this.moverWrapper.querySelector("[data-role=image-pos-down]"),this.leftButton=this.moverWrapper.querySelector("[data-role=image-pos-left]")},_bindEvents:function(){this.upButton.addEventListener("touchstart",this._onTouchstartUpButton.bind(this)),this.rightButton.addEventListener("touchstart",this._onTouchstartRightButton.bind(this)),this.downButton.addEventListener("touchstart",this._onTouchstartDownButton.bind(this)),this.leftButton.addEventListener("touchstart",this._onTouchstartLeftButton.bind(this)),this.moverWrapper.addEventListener("touchend",this._onTouchendMoverWrapper.bind(this))},_onTouchstartUpButton:function(a){a.stopPropagation(),a.preventDefault(),this._intervalReposition(function(a){return a.y=a.y-1,a})},_onTouchstartRightButton:function(a){a.stopPropagation(),a.preventDefault(),this._intervalReposition(function(a){return a.x=a.x+1,a})},_onTouchstartDownButton:function(a){a.stopPropagation(),a.preventDefault(),this._intervalReposition(function(a){return a.y=a.y+1,a})},_onTouchstartLeftButton:function(a){a.stopPropagation(),a.preventDefault(),this._intervalReposition(function(a){return a.x=a.x-1,a})},_onTouchendMoverWrapper:function(a){a.stopPropagation(),a.preventDefault(),clearTimeout(this._timeoutTimer),clearInterval(this._intervalTimer),this._timeoutTimer=0,this._intervalTimer=0},_intervalReposition:function(a){var b=this;b._reposition(a),this._timeoutTimer=setTimeout(function(){b._intervalTimer=setInterval(function(){b._reposition(a)},100)},300)},_reposition:function(a){var b=this._model.position();this._model.position(a(b))}},lt.controller.Opaciter=function(a,b){this.opacityWrapper=a,this.opacityArea=null,this.opacityButton=null,this._opacityAreaHeight=0,this._touchstartY=0,this._elementY=0,this._model=b,this._assignElements(),this._bindEvents(),this._computeOpacityAreaHeight(),this._move(100*this._model.opacity())},lt.controller.Opaciter.prototype={_OPACITY_MIN:0,_OPACITY_MAX:100,_assignElements:function(){this.opacityButton=this.opacityWrapper.querySelector("button"),this.opacityArea=this.opacityWrapper.querySelector(".lt-opacity-area")},_bindEvents:function(){this.opacityButton.addEventListener("touchstart",this._onTouchstartButton.bind(this)),this.opacityButton.addEventListener("touchmove",this._onTouchmoveButton.bind(this)),this.opacityButton.addEventListener("touchend",this._onTouchendButton.bind(this))},_onTouchstartButton:function(a){a.stopPropagation(),a.preventDefault();var b=a.touches[0];this._touchstartY=b.clientY,this._elementY=parseInt(this.opacityButton.style.top,10),this._model.opacityToPercent(this._elementY)},_onTouchmoveButton:function(a){a.stopPropagation(),a.preventDefault();var b=a.touches[0],c=b.clientY,d=-1*(this._touchstartY-c),e=d/this._opacityAreaHeight*100+this._elementY;e<this._OPACITY_MIN&&(e=this._OPACITY_MIN),e>this._OPACITY_MAX&&(e=this._OPACITY_MAX),this._move(e),this._model.opacityToPercent(e)},_onTouchendButton:function(a){a.stopPropagation(),a.preventDefault();var b=parseInt(this.opacityButton.style.top,10);this._model.opacityToPercent(b)},_computeOpacityAreaHeight:function(){this._opacityAreaHeight=parseInt(window.getComputedStyle(this.opacityArea).height,10)},_move:function(a){this.opacityButton.style.top=a+"%"}},lt.helper.Observer=function(){this.callbacks={}},lt.helper.Observer.prototype={subscribe:function(a,b){this.callbacks[a]=this.callbacks[a]||[],this.callbacks[a].push(b)},publish:function(a,b){var c=this;return void 0===this.callbacks?!1:void 0===this.callbacks[a]?!1:void this.callbacks[a].forEach(function(a){a.apply(c,b)})}},lt.model.Images=function(a,b){this.images=b||[],this._path=new lt.model.Path(a),this._opacity=new lt.model.Opacity(a),this._position=new lt.model.Position(a)},lt.model.Images.prototype={each:function(a,b){b=b||this,this.images.forEach(a,b)},count:function(){return this.images.length},path:function(a){return this._path.value(a)},position:function(a){return this._position.value(a)},opacity:function(a){return this._opacity.value(a)},opacityToPercent:function(a){this._opacity.toPercent(a)},addPathListener:function(a){this._path.addUpdateListener(a)},addOpacityListener:function(a){this._opacity.addUpdateListener(a)},addPositionListener:function(a){this._position.addUpdateListener(a)},clear:function(){this._path.clear(),this._opacity.clear(),this._position.clear()}},lt.model.Opacity=function(a){this._identifier=a,this._opacity=parseFloat(localStorage.getItem(this._identifier+":opacity"))||0,this._observer=new lt.helper.Observer},lt.model.Opacity.prototype={value:function(a){return void 0===a?this._opacity:(this._opacity=parseFloat(a.toFixed(1)),this._observer.publish("update",[this._opacity]),void localStorage.setItem(this._identifier+":opacity",a))},clear:function(){this._opacity=0,this._observer.publish("update",[this._opacity]),localStorage.removeItem(this._identifier+":opacity")},addUpdateListener:function(a){this._observer.subscribe("update",a)},toPercent:function(a){this.value(a/100)}},lt.model.Path=function(a){this._identifier=a,this._path=localStorage.getItem(this._identifier+":path")||null,this._observer=new lt.helper.Observer},lt.model.Path.prototype={value:function(a){return void 0===a?this._path:(this._path=a,this._observer.publish("update",[this._path]),void localStorage.setItem(this._identifier+":path",a))},addUpdateListener:function(a){this._observer.subscribe("update",a)},clear:function(){this._path=null,this._observer.publish("update",[this._opacity]),localStorage.removeItem(this._identifier+":path")}},lt.model.Position=function(a){this._identifier=a,this._x=parseInt(localStorage.getItem(this._identifier+":x"),10)||0,this._y=parseInt(localStorage.getItem(this._identifier+":y"),10)||0,this._observer=new lt.helper.Observer},lt.model.Position.prototype={value:function(a){return void 0===a?{x:this._x,y:this._y}:(this._x=a.x,this._y=a.y,this._observer.publish("update",[a]),localStorage.setItem(this._identifier+":x",a.x),void localStorage.setItem(this._identifier+":y",a.y))},addUpdateListener:function(a){this._observer.subscribe("update",a)},clear:function(){this._x=0,this._y=0,this._observer.publish("update",[{x:this._x,y:this._y}]),localStorage.removeItem(this._identifier+":x"),localStorage.removeItem(this._identifier+":y")}};