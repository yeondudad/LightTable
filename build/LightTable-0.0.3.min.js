function LightTable(a){document.body.insertAdjacentHTML("beforeend",lt.template.lightTable);var b=new lt.model.Paths(a),c=new lt.model.Guide,d=new lt.view.ImagesSlider,e=new lt.view.Opaciter,f=new lt.view.Guide,g=new lt.view.Mover;lt.controller.ImagesSlider(d,b),lt.controller.Opaciter(e,c),lt.controller.Guide(f,b,c),lt.controller.Mover(g,c)}window.lt||(window.lt={}),lt.model=lt.model||{},lt.controller=lt.controller||{},lt.view=lt.view||{},lt.template=lt.template||{},lt.helper=lt.helper||{},lt.util=lt.util||{},lt.controller.Guide=function(a,b,c){if(!(this instanceof lt.controller.Guide))return new lt.controller.Guide(a,b,c);this._view=a,this._paths=b,this._guide=c,this._bindNotification();var d=this._paths.currentPath(),e=this._guide.opacity(),f=this._guide.x(),g=this._guide.y();this._view.render(d,e,f,g)},lt.controller.Guide.prototype={_bindNotification:function(){this._paths.addUpdateListener(this.onUpdatePath.bind(this)),this._guide.addUpdateListener(this.onUpdateGuide.bind(this))},onUpdatePath:function(a){var b=this._guide.opacity(),c=this._guide.x(),d=this._guide.y();this._view.render(a,b,c,d)},onUpdateGuide:function(a,b,c){var d=this._paths.currentPath();this._view.render(d,a,b,c)}},lt.controller.ImagesSlider=function(a,b){return this instanceof lt.controller.ImagesSlider?(this._paths=b,this._view=a,this._panelX=0,this._deltaX=0,this._startX=0,this._startTime=0,this._isSwipeLeft=!1,this._doPresentation(),this._bindUIActions(),void lt.util.screenRotate(this._doPresentation.bind(this))):new lt.controller.ImagesSlider(a,b)},lt.controller.ImagesSlider.prototype={_doPresentation:function(){var a=lt.util.screenWidth(),b=this._paths.currentKey();this._view.render(this._paths.list()),this._view.swipe(b*-a)},_bindUIActions:function(){this._view.imagesWrapper.addEventListener("touchmove",this._onTouchmoveImagesWrapper.bind(this)),this._view.selectButton.addEventListener("click",this._onClickImageSelector.bind(this)),this._view.imagesList.addEventListener("click",this._onClickImagesChoiceButton.bind(this)),this._view.imagesList.addEventListener("touchstart",this._onTouchstartImagesList.bind(this)),this._view.imagesList.addEventListener("touchmove",this._onTouchmoveImagesList.bind(this)),this._view.imagesList.addEventListener("touchend",this._onTouchendImagesList.bind(this))},_onTouchmoveImagesWrapper:function(a){a.preventDefault()},_onClickImageSelector:function(){this._view.show()},_onClickImagesChoiceButton:function(a){"BUTTON"===a.target.tagName&&(this._paths.save(),this._view.hide())},_onTouchstartImagesList:function(a){var b=lt.util.screenWidth(),c=this._paths.currentKey();this._deltaX=0,this._panelX=c*-b,this._startX=a.touches[0].pageX,this._startTime=Date.now()},_onTouchmoveImagesList:function(a){this._deltaX=a.touches[0].pageX-this._startX,this._isSwipeLeft=this._deltaX<0,(this._paths.isFirst()&&!this._isSwipeLeft||this._paths.isLast()&&this._isSwipeLeft)&&(this._deltaX=this._deltaX/2.5),this._view.swipe(this._deltaX+this._panelX)},_onTouchendImagesList:function(){var a=Date.now()-this._startTime,b=lt.util.screenWidth(),c=0;Math.abs(this._deltaX)>b/2.5&&(!this._paths.isLast()&&this._isSwipeLeft?this._paths.next():this._paths.isFirst()||this._isSwipeLeft||this._paths.prev()),c=this._paths.currentKey(),this._view.swipe(c*-b,a)}},lt.controller.Mover=function(a,b){return this instanceof lt.controller.Mover?(this._timeoutTimer=0,this._intervalTimer=0,this._view=a,this._guide=b,this._initDragger(),void this._bindUIActions()):new lt.controller.Mover(a,b)},lt.controller.Mover.prototype={_initDragger:function(){var a="LightTable::MoverDragger",b=this._view.moverWrapper,c=this._view.draggerButton;lt.helper.Dragger(a,b,c)},_bindUIActions:function(){this._view.upButton.addEventListener("touchstart",this._onTouchstartUpButton.bind(this)),this._view.rightButton.addEventListener("touchstart",this._onTouchstartRightButton.bind(this)),this._view.downButton.addEventListener("touchstart",this._onTouchstartDownButton.bind(this)),this._view.leftButton.addEventListener("touchstart",this._onTouchstartLeftButton.bind(this)),this._view.moverWrapper.addEventListener("touchend",this._onTouchendMoverWrapper.bind(this))},_onTouchstartUpButton:function(a){a.preventDefault(),this._intervalReposition(function(a){return a.y=a.y-1,a})},_onTouchstartRightButton:function(a){a.preventDefault(),this._intervalReposition(function(a){return a.x=a.x+1,a})},_onTouchstartDownButton:function(a){a.preventDefault(),this._intervalReposition(function(a){return a.y=a.y+1,a})},_onTouchstartLeftButton:function(a){a.preventDefault(),this._intervalReposition(function(a){return a.x=a.x-1,a})},_onTouchendMoverWrapper:function(a){a.preventDefault(),clearTimeout(this._timeoutTimer),clearInterval(this._intervalTimer),this._timeoutTimer=0,this._intervalTimer=0},_intervalReposition:function(a){var b=this;b._reposition(a),this._timeoutTimer=setTimeout(function(){b._intervalTimer=setInterval(function(){b._reposition(a)},100)},300)},_reposition:function(a){var b=a({x:this._guide.x(),y:this._guide.y()});this._guide.x(b.x),this._guide.y(b.y)}},lt.controller.Opaciter=function(a,b){return this instanceof lt.controller.Opaciter?(this._touchstartY=0,this._elementY=0,this._guide=b,this._view=a,this._initDragger(),this._bindUIActions(),void this._view.render(this._guide.percent(),0)):new lt.controller.Opaciter(a,b)},lt.controller.Opaciter.prototype={_initDragger:function(){var a="LightTable::OpaciterDragger",b=this._view.opacityWrapper,c=this._view.draggerButton;lt.helper.Dragger(a,b,c)},_bindUIActions:function(){this._view.opacityWrapper.addEventListener("touchmove",this._onTouchmoveOpacityWrapper.bind(this)),this._view.opacityButton.addEventListener("touchstart",this._onTouchstartOpacityButton.bind(this)),this._view.opacityButton.addEventListener("touchmove",this._onTouchmoveOpacityButton.bind(this))},_onTouchmoveOpacityWrapper:function(a){a.preventDefault()},_onTouchstartOpacityButton:function(a){this._touchstartY=a.touches[0].clientY,this._elementY=this._guide.percent()},_onTouchmoveOpacityButton:function(a){var b=a.touches[0].clientY,c=-1*(this._touchstartY-b),d=parseInt(c/this._view.opacityAreaHeight*100+this._elementY,10);0>d&&(d=0),d>100&&(d=100),this._guide.percent(d),this._view.render(d,0)}},lt.helper.Dragger=function(a,b,c){if(!(this instanceof lt.helper.Dragger))return new lt.helper.Dragger(a,b,c);this._identifier=a,this.dragTarget=b,this.dragButton=c,this._touchPosition={},this._elementPosition={};var d=localStorage.getItem(this._identifier+"::x")||0,e=localStorage.getItem(this._identifier+"::y")||0;this._bindEvents(),this._dragging(d,e)},lt.helper.Dragger.prototype={_bindEvents:function(){this.dragButton.addEventListener("touchstart",this._onTouchstartDragButton.bind(this)),this.dragButton.addEventListener("touchmove",this._onTouchmoveDragButton.bind(this)),this.dragButton.addEventListener("touchend",this._onTouchendDragButton.bind(this))},_onTouchstartDragButton:function(a){a.preventDefault(),a.stopPropagation(),this._touchPosition.x=a.touches[0].clientX,this._touchPosition.y=a.touches[0].clientY,this._elementPosition.x=parseInt(this.dragTarget.style.left,10),this._elementPosition.y=parseInt(this.dragTarget.style.top,10)},_onTouchmoveDragButton:function(a){a.preventDefault(),a.stopPropagation();var b=a.touches[0].clientX-this._touchPosition.x,c=a.touches[0].clientY-this._touchPosition.y,d=b+this._elementPosition.x,e=c+this._elementPosition.y;this._dragging(d,e)},_onTouchendDragButton:function(a){a.preventDefault(),a.stopPropagation();var b=a.changedTouches[0].clientX-this._touchPosition.x,c=a.changedTouches[0].clientY-this._touchPosition.y,d=b+this._elementPosition.x,e=c+this._elementPosition.y;localStorage.setItem(this._identifier+"::x",d),localStorage.setItem(this._identifier+"::y",e)},_dragging:function(a,b){this.dragTarget.style.left=a+"px",this.dragTarget.style.top=b+"px"}},lt.helper.Observer=function(){this.callbacks={}},lt.helper.Observer.prototype={subscribe:function(a,b){this.callbacks[a]=this.callbacks[a]||[],this.callbacks[a].push(b)},publish:function(a,b){var c=this;return void 0===this.callbacks?!1:void 0===this.callbacks[a]?!1:void this.callbacks[a].forEach(function(a){a.apply(c,b)})}},lt.model.Guide=function(){this._opacity=parseFloat(localStorage.getItem("LightTable::opacity"))||0,this._x=parseInt(localStorage.getItem("LightTable::x"),10)||0,this._y=parseInt(localStorage.getItem("LightTable::y"),10)||0,this._observer=new lt.helper.Observer},lt.model.Guide.prototype={opacity:function(a){return void 0===a?this._opacity:(a=parseFloat(a.toFixed(1)),localStorage.setItem("LightTable::opacity",a),this._opacity=a,void this._publish())},percent:function(a){return void 0===a?100*this._opacity:void this.opacity(a/100)},x:function(a){return void 0===a?this._x:(localStorage.setItem("LightTable::x",a),this._x=parseInt(a,10),void this._publish())},y:function(a){return void 0===a?this._y:(localStorage.setItem("LightTable::y",a),this._y=parseInt(a,10),void this._publish())},addUpdateListener:function(a){this._observer.subscribe("update",a)},clear:function(){this._opacity=0,this._x=0,this._y=0,this._observer.publish("remove"),localStorage.removeItem("LightTable::opacity"),localStorage.removeItem("LightTable::x"),localStorage.removeItem("LightTable::y")},_publish:function(){this._observer.publish("update",[this._opacity,this._x,this._y])}},lt.model.Paths=function(a){this._paths=a||[],this._key=parseInt(localStorage.getItem("LightTable::key"),10)||0,this._observer=new lt.helper.Observer},lt.model.Paths.prototype={list:function(){return this._paths},currentKey:function(){return this._key},currentPath:function(){return this._paths[this.currentKey()]},next:function(){this._key<this._paths.length&&(this._key=this._key+1)},prev:function(){this._key>0&&(this._key=this._key-1)},isFirst:function(){return 0===this._key},isLast:function(){return this._key===this._paths.length-1},save:function(){var a=this._paths[this.currentKey()];this._observer.publish("update",[a]),localStorage.setItem("LightTable::key",this.currentKey())},addUpdateListener:function(a){this._observer.subscribe("update",a)},clear:function(){this._key=0,this._observer.publish("remove"),localStorage.removeItem("LightTable::key")}},lt.template.lightTable='<div id="light-table"><div class="lt-navigation"><div class="lt-search"><button type="button" data-role="image-search"><span>검색</span></button></div><div class="lt-opacity"><div class="lt-opacity-bar"><div class="lt-opacity-area"><button type="button" data-role="image-opacity"><span>투명도 조정</span></button></div></div></div><div class="lt-dragger"><button type="button" data-role="navigation-dragger"><span>이동</span></button></div></div><div class="lt-mover"><div class="lt-mover-buttons"><button type="button" data-role="image-pos-up"><span>&#8593;</span></button><button type="button" data-role="image-pos-right"><span>&#8594;</span></button><button type="button" data-role="image-pos-down"><span>&#8595;</span></button><button type="button" data-role="image-pos-left"><span>&#8592;</span></button></div><div class="lt-dragger"><button type="button" data-role="mover-dragger"><span>이동</span></button></div></div><div class="lt-images"><ul></ul></div><div class="lt-guide"></div></div>',lt.util.isLandscape=function(){return window.innerHeight<window.innerWidth},lt.util.screenRotate=function(){var a=0,b=null,c=new lt.helper.Observer;return window.addEventListener("resize",function(){clearTimeout(a),a=setTimeout(function(){c.publish("rotate",[lt.util.isLandscape()])},500)},!1),b=function(a){void 0!==a&&c.subscribe("rotate",a)}}(),lt.util.screenWidth=function(){return lt.util.isLandscape()?screen.height:screen.width},lt.view.Guide=function(){this.guideWrapper=null,this._path="",this._assignElements()},lt.view.Guide.prototype={render:function(a,b,c,d){a!==this._path&&(this.guideWrapper.innerHTML='<img src="'+a+'">',this._path=a),this.guideWrapper.style.left=c+"px",this.guideWrapper.style.top=d+"px",this.guideWrapper.style.opacity=b},_assignElements:function(){this.guideWrapper=document.querySelector("#light-table .lt-guide")}},lt.view.ImagesSlider=function(){this.selectButton=null,this.imagesWrapper=null,this.imagesList=null,this._assignElements()},lt.view.ImagesSlider.prototype={render:function(a){var b=lt.util.screenWidth(),c=b-40,d="";a.forEach(function(a){d=d+'<li class="lst-img" style="margin:0 0 0 0px;width:'+c+'px"><button>선택</button><img src="'+a+'"/></li>'}),this.imagesList.innerHTML=d},show:function(){this.imagesWrapper.style.display="block"},hide:function(){this.imagesWrapper.style.display="none"},swipe:function(a,b){var c="",d=this.imagesList.style;b=b||0,b>500&&(b=500),c="all "+b+"ms",["webkit","moz","ms","o"].forEach(function(a){d[a+"Transition"]=c}),d.margin="0 0 0 "+a+"px",d.transition=c},_assignElements:function(){this.selectButton=document.querySelector("#light-table .lt-search button"),this.imagesWrapper=document.querySelector("#light-table .lt-images"),this.imagesList=this.imagesWrapper.querySelector("ul")}},lt.view.Mover=function(){this._assignElements()},lt.view.Mover.prototype={_assignElements:function(){this.moverWrapper=document.querySelector("#light-table .lt-mover"),this.upButton=this.moverWrapper.querySelector("[data-role=image-pos-up]"),this.rightButton=this.moverWrapper.querySelector("[data-role=image-pos-right]"),this.downButton=this.moverWrapper.querySelector("[data-role=image-pos-down]"),this.leftButton=this.moverWrapper.querySelector("[data-role=image-pos-left]"),this.draggerButton=this.moverWrapper.querySelector(".lt-dragger button")}},lt.view.Opaciter=function(){this.opacityButton=null,this.opacityArea=null,this.opacityAreaHeight=0,this._assignElements(),this._setComputeOpacityAreaHeight()},lt.view.Opaciter.prototype={render:function(a){this.opacityButton.style.top=a+"%"},_assignElements:function(){this.opacityWrapper=document.querySelector("#light-table .lt-navigation"),this.opacityArea=this.opacityWrapper.querySelector(".lt-opacity-area"),this.opacityButton=this.opacityWrapper.querySelector(".lt-opacity-area button"),this.draggerButton=this.opacityWrapper.querySelector(".lt-dragger button")},_setComputeOpacityAreaHeight:function(){this.opacityAreaHeight=parseInt(window.getComputedStyle(this.opacityArea).height,10)}};